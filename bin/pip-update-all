#!/bin/zsh

if [[ -z ${PIP} ]]; then
    if where pip3 &> /dev/null; then
        PIP=pip3
    elif where pip-3.7 &> /dev/null; then
        PIP=pip-3.7
    elif where pip-3.6 &> /dev/null; then
        PIP=pip-3.6
    elif where pip-3.5 &> /dev/null; then
        PIP=pip-3.5
    elif where pip-3.4 &> /dev/null; then
        PIP=pip-3.4
    else
        echo '[!!!!] no pip3 found' >&2
        exit 1
    fi
fi

if [[ x"${PIP}" == x'-m' ]]; then
    packages_to_update="$(python3 -m pip list --outdated --format=columns | sed 1,2d | awk '{print $1}')"
    if [[ "$packages_to_update" == '' ]]; then
        : # already up to date
    else
        echo "$packages_to_update" | xargs python3 -m pip install --upgrade
    fi
else
    packages_to_update="$($PIP list --outdated --format=columns | sed 1,2d | awk '{print $1}')"
    if [[ "$packages_to_update" == '' ]]; then
        : # already up to date
    else
        echo "$packages_to_update" | xargs $PIP install --upgrade
    fi
fi
